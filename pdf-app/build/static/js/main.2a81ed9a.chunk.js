(this["webpackJsonppdf-app"]=this["webpackJsonppdf-app"]||[]).push([[0],{50:function(e,t,i){},51:function(e,t,i){},62:function(e,t,i){"use strict";i.r(t);var a=i(14),s=i.n(a),n=i(28),r=i.n(n),l=(i(50),i(17)),o=(i(51),i(11)),c=i(20),d=i.n(c),g=i(44),h=i(45),p=i(5);Object(g.polyfill)({dragImageTranslateOverride:h.scrollBehaviourDragImageTranslateOverride}),window.addEventListener("touchmove",function(){});const x="A4",f="US Letter",b="Same as Image",u="Portrait",m="Landscape",j="0",y="20",O="50";class v extends s.a.Component{constructor(e){super(e),this.clearSelection=()=>{let e=[...this.state.images];e.forEach(e=>{e.selected=!1}),this.setState({images:e})},this.readfiles=async e=>{if(console.log(e.length),this.state.images.length+e.length>300)return this.setState({imageCountError:"\u65e0\u6cd5\u6dfb\u52a0\u56fe\u7247\u3002\u5f53\u524d\u5df2\u6709 ".concat(this.state.images.length," \u5f20\u56fe\u7247\uff0c\u6700\u591a\u53ea\u80fd\u6dfb\u52a0 ").concat(300," \u5f20\u56fe\u7247\u3002")}),void setTimeout(()=>this.setState({imageCountError:void 0}),5e3);let t=[],i=0;for(let s=0;s<e.length;s++)if(console.log("Type: "+e[s].type),"image/png"===e[s].type||"image/x-png"===e[s].type||"image/jpeg"===e[s].type||"image/webp"===e[s].type)try{const i=window.URL.createObjectURL(e[s]);let a=this.uuidv4();console.log("uuid: "+a),t.push({id:a,imgDataUrl:i,file:e[s],selected:!1})}catch(a){console.error("Error processing file:",e[s].name,a),i++}else i++;i>0&&(this.setState({imageCountError:"\u6709 ".concat(i," \u4e2a\u6587\u4ef6\u65e0\u6cd5\u5904\u7406\u3002\u8bf7\u786e\u4fdd\u53ea\u9009\u62e9 JPEG\u3001PNG \u6216 WebP \u683c\u5f0f\u7684\u56fe\u7247\u3002")}),setTimeout(()=>this.setState({imageCountError:void 0}),5e3)),t.length>0&&this.setState(e=>({images:[...e.images,...t]}))},this.loadImage=e=>new Promise((t,i)=>{let a=new Image;a.onload=()=>{t(a)},a.onerror=e=>{i(e)},a.src=e}),this.fetchImage=async(e,t)=>{if(t){let a=await this.loadImage(e),s=document.createElement("canvas"),n=s.getContext("2d");s.width=a.width,s.height=a.height,n.drawImage(a,0,0,a.width,a.height);let r=await this.canvasToBlob(s,t),l=await r.arrayBuffer(),o="";try{o=(await fetch(e)).headers.get("content-type")||""}catch(i){console.error("Failed to get original MIME type:",i)}return{arrayBuffer:l,mime:o||"image/jpeg"}}{let t=await fetch(e);return{arrayBuffer:await t.arrayBuffer(),mime:t.headers.get("content-type")}}},this.createPdf=async()=>{let e="";try{this.setState({busy:!0});const s=await o.PDFDocument.create();for(let t=0;t<this.state.images.length;t++){let n=this.getPageSize(),r=await this.fetchImage(this.state.images[t].imgDataUrl,this.state.compressImages?this.state.imageQuality/10:void 0),l=await r.arrayBuffer;e=r.mime,console.log(e);let c,g=1;if("image/jpeg"===e)try{let e=d.a.readFromBinaryFile(l);e.Orientation&&(g=e.Orientation,console.log("jpegOrientation: "+g))}catch(i){console.error(i)}if("image/jpeg"===e)c=await s.embedJpg(l);else if("image/webp"===e)try{let e=await this.loadImage(this.state.images[t].imgDataUrl),i=document.createElement("canvas"),a=i.getContext("2d");i.width=e.width,i.height=e.height,a.drawImage(e,0,0);let n=await new Promise(e=>i.toBlob(e,"image/png")),r=await n.arrayBuffer();c=await s.embedPng(r)}catch(a){console.error("WebP conversion failed, falling back to direct embedding:",a),c=await s.embedPng(l)}else c=await s.embedPng(l);const h=c;if(console.log("width: "+h.width+" height: "+h.height),this.state.pageSize===b)n=[h.width,h.height];else switch(g){case 6:case 8:n=[n[1],n[0]]}const p=s.addPage(n);if(this.state.pageSize===b)p.drawImage(h,{x:0,y:0,width:h.width,height:h.height});else{let e=Math.min((p.getWidth()-this.state.pageMargin)/h.width,(p.getHeight()-this.state.pageMargin)/h.height);h.width,h.height;console.log(h.width+" "+h.height),console.log(p.getWidth()+" "+p.getHeight());let t=h.scale(e);p.drawImage(h,{x:p.getWidth()/2-t.width/2,y:p.getHeight()/2-t.height/2,width:t.width,height:t.height})}switch(g){case 6:p.setRotation(Object(o.degrees)(90));break;case 3:p.setRotation(Object(o.degrees)(180));break;case 8:p.setRotation(Object(o.degrees)(270))}}const n=await s.save();let r=new Blob([n],{type:"application/pdf"});var t=document.createElement("a");t.href=window.URL.createObjectURL(r);t.download="file.pdf",t.click(),this.setState({busy:!1})}catch(s){console.error(s),this.setState({lastError:s,lastMime:e,busy:!1})}},this.deletePage=e=>{console.log("To delete: "+e);let t=[...this.state.images],i=-1;t.forEach((t,a)=>{t.id===e&&(i=a)}),t.splice(i,1),this.setState({images:t})},this.handleDrop=(e,t)=>{console.log("droppedId: "+e+" currentId: "+t);let i=-1,a=[...this.state.images];a.forEach((t,a)=>{t.id===e&&(i=a)});let s=a.splice(i,1)[0],n=-1;a.forEach((e,i)=>{e.id===t&&(n=i)}),a.splice(n,0,s),console.log(a),this.setState({images:a})},this.getPageSize=()=>{switch(this.state.pageSize){case x:if(this.state.pageOrientation===u)return o.PageSizes.A4;{let e=[...o.PageSizes.A4];return e.reverse(),e}case f:if(this.state.pageOrientation===u)return o.PageSizes.Letter;{let e=[...o.PageSizes.Letter];return e.reverse(),e}default:return}},this.getAspectRatio=()=>{let e=this.getPageSize();return e[0]/e[1]},this.state={images:[],pageOrientation:u,pageSize:x,pageMargin:j,lastError:void 0,lastMime:void 0,forceShowOption:!1,compressImages:!1,imageQuality:8,busy:!1,imageCountError:void 0},this.fileInput=s.a.createRef()}render(){let e={height:"192px",width:"192px",border:"none",display:"flex",background:"white",position:"relative"},t={margin:"0px",flex:"1",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"};this.state.pageMargin===y?t.margin="5px":this.state.pageMargin===O&&(t.margin="10px"),this.state.pageSize!==b&&(e.width=Math.ceil(192*this.getAspectRatio())+"px",e.boxShadow="5px 5px 5px rgb(200,200,200)");const i=Object(p.jsxs)("div",{className:"landing-page",children:[Object(p.jsxs)("div",{style:{padding:"40px"},children:["Convert JPEG, PNG or WebP images to PDF without uploading your sensitve data anywhere.",Object(p.jsx)("br",{}),"Files are processed entirely on your device and does not get uploaded to any server."]}),Object(p.jsx)("button",{onClick:()=>this.fileInput.current.click(),className:"big-btn",children:"Select Images"}),Object(p.jsx)("div",{className:"dropzone",onDragStart:e=>{},onDrop:e=>{e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();let t=e.dataTransfer.files;this.readfiles(t)},onDragOver:e=>{e.preventDefault&&e.preventDefault()},onDragEnter:e=>{e.preventDefault()},children:"or drop images here"})]}),a=Object(p.jsx)("div",{style:{display:"flex",flexWrap:"wrap",flex:"1",justifyContent:"center"},children:this.state.images.map((i,a)=>Object(p.jsx)("div",{style:{padding:"5px"},draggable:!0,onDragStart:e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",i.id),console.log("Drag start "+a)},onDrop:e=>{e.stopPropagation&&e.stopPropagation();let t=e.dataTransfer.getData("text/plain");console.log("droppedId: "+t),this.handleDrop(t,i.id)},onDragOver:e=>{e.preventDefault&&e.preventDefault()},onDragEnter:e=>{e.preventDefault()},children:Object(p.jsxs)("div",{style:Object(l.a)({},e),onClick:e=>{let t=[...this.state.images];for(let a=0;a<t.length;a++)t[a]=Object(l.a)(Object(l.a)({},t[a]),{},{selected:t[a].id===i.id});this.setState({images:[...t]}),e.stopPropagation()},children:[Object(p.jsx)("div",{style:{display:i.selected?"block":"none",position:"absolute",right:"0px",top:"0px",padding:"5px",color:"rgb(180,180,180)"},onClick:e=>{e.stopPropagation(),this.deletePage(i.id)},children:Object(p.jsx)("i",{className:"fa fa-trash","aria-hidden":"true"})}),Object(p.jsx)("div",{style:Object(l.a)(Object(l.a)({},t),{},{backgroundImage:"url('"+i.imgDataUrl+"')"})})]})},i.id+""))}),s=Object(p.jsxs)("div",{children:[Object(p.jsx)("div",{style:{paddingBottom:"10px",fontSize:"16px",color:"gray",paddingTop:"20px"},children:"Page margin"}),Object(p.jsxs)("div",{style:{display:"flex"},children:[Object(p.jsx)("div",{style:{flex:"1",height:"50px",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",background:this.state.pageMargin==j?"purple":"rgb(240,240,240)",color:this.state.pageMargin==j?"white":"black",padding:"5px"},onClick:()=>this.setState({pageMargin:j}),children:"None"}),Object(p.jsx)("div",{style:{flex:"1",height:"50px",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",background:this.state.pageMargin==y?"purple":"rgb(240,240,240)",color:this.state.pageMargin==y?"white":"black",padding:"5px"},onClick:()=>this.setState({pageMargin:y}),children:"Small"}),Object(p.jsx)("div",{style:{flex:"1",height:"50px",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",background:this.state.pageMargin==O?"purple":"rgb(240,240,240)",color:this.state.pageMargin==O?"white":"black",padding:"5px"},onClick:()=>this.setState({pageMargin:O}),children:"Big"})]})]}),n=Object(p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(p.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:"Image quality"}),Object(p.jsxs)("div",{style:{display:"flex"},children:[Object(p.jsx)("div",{style:{padding:"5px"},children:Object(p.jsx)("button",{onClick:()=>{this.state.imageQuality<10&&this.setState({imageQuality:+this.state.imageQuality+1})},children:"+"})}),Object(p.jsx)("div",{style:{padding:"5px"},children:Object(p.jsx)("div",{children:this.state.imageQuality/10})}),Object(p.jsx)("div",{style:{padding:"5px"},children:Object(p.jsx)("button",{onClick:()=>{this.state.imageQuality>1&&this.setState({imageQuality:+this.state.imageQuality-1})},children:"-"})})]})]}),r={};this.state.forceShowOption&&(r.display="block");const o=this.state.forceShowOption?Object(p.jsx)("span",{onClick:()=>{this.setState({forceShowOption:!1})},children:"X"}):Object(p.jsx)("span",{}),c=Object(p.jsxs)("div",{className:"options",style:r,children:[Object(p.jsxs)("div",{style:{paddingBottom:"10px",fontSize:"20px",display:"flex",justifyContent:"space-between"},children:[Object(p.jsx)("span",{children:"Options"}),o]}),Object(p.jsx)("div",{style:{paddingBottom:"10px",fontSize:"16px",color:"gray",paddingTop:"10px"},children:"Page orientation"}),Object(p.jsxs)("div",{style:{display:"flex"},children:[Object(p.jsx)("div",{style:{flex:"1",height:"50px",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",background:this.state.pageOrientation==u?"purple":"rgb(240,240,240)",color:this.state.pageOrientation==u?"white":"black",padding:"5px"},onClick:()=>this.setState({pageOrientation:u}),children:"Portrait"}),Object(p.jsx)("div",{style:{flex:"1",height:"50px",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",background:this.state.pageOrientation==m?"purple":"rgb(240,240,240)",color:this.state.pageOrientation==m?"white":"black",padding:"5px"},onClick:()=>this.setState({pageOrientation:m}),children:"Landscape"})]}),Object(p.jsx)("div",{style:{paddingBottom:"10px",fontSize:"16px",color:"gray",paddingTop:"20px"},children:"Page size"}),Object(p.jsxs)("div",{style:{display:"flex"},children:[Object(p.jsx)("div",{style:{flex:"1",height:"50px",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",background:this.state.pageSize==x?"purple":"rgb(240,240,240)",color:this.state.pageSize==x?"white":"black",padding:"5px"},onClick:()=>this.setState({pageSize:x}),children:"A4"}),Object(p.jsx)("div",{style:{flex:"1",height:"50px",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",background:this.state.pageSize==f?"purple":"rgb(240,240,240)",color:this.state.pageSize==f?"white":"black",padding:"5px"},onClick:()=>this.setState({pageSize:f}),children:"US Letter"}),Object(p.jsx)("div",{style:{flex:"1",height:"50px",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",background:this.state.pageSize==b?"purple":"rgb(240,240,240)",color:this.state.pageSize==b?"white":"black",padding:"5px"},onClick:()=>this.setState({pageSize:b}),children:"Same as Image"})]}),this.state.pageSize!==b?s:Object(p.jsx)("div",{}),Object(p.jsx)("div",{style:{paddingBottom:"10px",fontSize:"16px",color:"gray",paddingTop:"20px"},children:"Compression"}),Object(p.jsxs)("div",{style:{display:"flex"},children:[Object(p.jsx)("div",{style:{flex:"1",height:"50px",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",background:this.state.compressImages?"purple":"rgb(240,240,240)",color:this.state.compressImages?"white":"black",padding:"5px"},onClick:()=>this.setState({compressImages:!0}),children:"Compress Images"}),Object(p.jsx)("div",{style:{flex:"1",height:"50px",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",background:this.state.compressImages?"rgb(240,240,240)":"purple",color:this.state.compressImages?"black":"white",padding:"5px"},onClick:()=>this.setState({compressImages:!1}),children:"Don't Compress"})]}),this.state.compressImages?n:Object(p.jsx)("div",{})]}),d=Object(p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px",borderTop:"1px solid rgb(200,200,200)"},children:[Object(p.jsxs)("div",{style:{display:"flex"},children:[Object(p.jsx)("div",{style:{paddingLeft:"5px",paddingRight:"5px"},children:Object(p.jsx)("button",{onClick:()=>{this.setState({forceShowOption:!0})},className:"option-btn button",children:"PDF Options"})}),Object(p.jsx)("button",{onClick:()=>this.fileInput.current.click(),className:"button",children:"Add page"})]}),Object(p.jsx)("button",{onClick:this.createPdf,className:"button",children:"Generate PDF"})]}),g=Object(p.jsxs)("div",{className:"page-header",children:[Object(p.jsx)("span",{children:"CONVERT IMAGE TO PDF"}),this.state.images.length>0&&Object(p.jsxs)("div",{style:{position:"absolute",right:"20px",top:"50%",transform:"translateY(-50%)",fontSize:"14px",color:"rgba(255,255,255,0.8)"},children:[this.state.images.length," / ",300," \u56fe\u7247"]})]}),h=this.state.imageCountError?Object(p.jsx)("div",{style:{backgroundColor:"#ff4444",color:"white",padding:"10px",textAlign:"center",borderRadius:"4px",margin:"10px"},children:this.state.imageCountError}):null;if(this.state.images.length<1)return Object(p.jsxs)("div",{children:[g,h,Object(p.jsx)("input",{type:"file",ref:this.fileInput,onChange:()=>this.readfiles(this.fileInput.current.files),multiple:!0,style:{display:"none"}}),i]});const v={};return this.state.busy&&(v.display="flex"),Object(p.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%",overflow:"hidden",flex:"1"},children:[g,h,Object(p.jsxs)("div",{style:{display:"flex",overflow:"hidden",flex:"1"},children:[Object(p.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%",flex:"1",overflow:"auto",background:"rgb(240,240,240)"},onClick:this.clearSelection,children:[a,Object(p.jsx)("div",{style:{flex:"1"}})]}),c]}),d,Object(p.jsx)("input",{type:"file",accept:"image/*,.webp",ref:this.fileInput,onChange:()=>this.readfiles(this.fileInput.current.files),multiple:!0,style:{display:"none"}}),Object(p.jsx)("div",{className:"busy",style:v,children:"Generating PDF, Please wait..."})]})}readExif(e){d.a.readFromBinaryFile(e)}canvasToBlob(e,t){return new Promise((i,a)=>{try{e.toBlob(i,"image/jpeg",t)}catch(s){a(s)}})}uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}var w=v;var S=e=>{e&&e instanceof Function&&i.e(3).then(i.bind(null,63)).then(t=>{let{getCLS:i,getFID:a,getFCP:s,getLCP:n,getTTFB:r}=t;i(e),a(e),s(e),n(e),r(e)})};i(61);r.a.render(Object(p.jsx)(s.a.StrictMode,{children:Object(p.jsx)(w,{})}),document.getElementById("root")),S()}},[[62,1,2]]]);
//# sourceMappingURL=main.2a81ed9a.chunk.js.map